<!-- <!DOCTYPE html> -->
<html>
	<head>
		<title>Wheel</title>
		<script type="text/javascript" src="http:threejs.org/build/three.min.js"></script>
		<script type="text/javascript" src="http:code.jquery.com/jquery-2.1.4.min.js"></script>
		<style>
		  body{margin: 0;overflow: hidden;}
		</style>
	</head>
	<body bgcolor="#000000">
		<div id="heart0" class="heart heart0"></div>
		<div id="heart1" class="heart heart1"></div>
		<div id="heart2" class="heart heart2"></div>
		<div id="heart3" class="heart heart3"></div>
		<div id="heart4" class="heart heart4"></div>
		<div id="heart5" class="heart heart5"></div>
		<div id="modal" class="modal" style="display: none; background-image: url('https://raw.githubusercontent.com/Blunderbread/threejsmaze/master/maze/masterwheel/textures/geometric.jpg')"><header class="modalheader"><h2 id="title"></h2><div id="modalcontent"><p id="description"></p></div></header></div>
		<div id="startButtonId"><button id="spin" class="button button1">Spin</button></div>
		<div id="startButtonId"><button id="reset" class="button button2">Reset</button></div>
		<style>
			* {
				 user-select: none;
				-khtml-user-select: none;
				-o-user-select: none;
				-moz-user-select: -moz-none;
				-webkit-user-select: none;
			}
			::selection { background: transparent;color:inherit; }
			::-moz-selection { background: transparent;color:inherit; }
			h2 {
				font-family: "Segoe UI",Arial,sans-serif;
				font-weight: 400;
				margin: 10px 0;
				font-size: 30px;
				color: white;
			}
			p {
				font-family: Arial,sans-serif;
				font-size: 15px;
				color: white;
			}
			img {
				z-index: 1;
			}
			.heart {
				position:absolute;
				top: 5px;
			}
			.heart0 {
				left: 5px;
			}
			.heart1 {
				left: 135px;
			}
			.heart2 {
				left: 265px;
			}
			.heart3 {
				left: 395px;
			}
			.heart4 {
				left: 525px;
			}
			.heart5 {
				left: 655px;
			}
			.button {
				display: inline-block;
				padding: 20px 15px;
				font-size: 24px;
				cursor: pointer;
				text-align: center;
				text-decoration: none;
				outline: none;
				color: #fff;
				background-color: #4CAF50;
				border: none;
				border-radius: 50%;
				box-shadow: 7px -4px #999;
				position: absolute;
				z-index: 1;
			}
			.button:hover {
				background-color: #3e8e41
			}
			.button:active {
			  background-color: #3e8e41;
			  box-shadow: 4px -3px #666;
			  transform: translate(4px, -2px);
			}
			.button1 {
				background-color: #000000;
				padding: 20px 15px;
				top: 41%;
				left: 29%;
			}
			.button1:hover {background-color: #333333}
			.button1:active {background-color: #FFFFFF}
			.button2 {
				bottom: 5%;
				right: 5%;
			}
			.modalheader {
				text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
			}
			.modal {
				border-radius: 5px;
				background-size: cover;
				filter: hue-rotate(90deg);
				position: absolute;
				bottom: -200px;
				left: 50px;
				padding: 20px;
				background-color: grey;
			}
			.threejs {
				position: absolute;
				top: 0px;
				left: 0px;
				z-index: -1;
			}	
		</style>
		<div id="WebGL-output" class="threejs"></div>
		  <script type="text/javascript">
			$(function(){ 	
				window.addEventListener( 'resize', onWindowResize, false );
				document.getElementById('spin').addEventListener('click', spinwheel);
				document.getElementById('reset').addEventListener('click', hardreset);
				var modal = document.getElementById('modal');
				
				function modalout() {
					var pos = 50;
					var id = setInterval(frame, 5);
					function frame() {
						if (pos <= -200) {
							clearInterval(id);
							modal.style.bottom = -200+'px';
							modal.style.display = "none"
						} else {
							pos-=4; 
							modal.style.bottom = pos + 'px';
						}
					}
				}
				
				function modalin() {
					modal.style.display = "block";
					var pos = -200;
					var id = setInterval(frame, 5);
					function frame() {
						if (pos >= 50) {
							modal.style.bottom = 50+'px';
							clearInterval(id);
						} else {
							pos+=4; 
							modal.style.bottom = pos + 'px';
						}
					}
				};
				
				String.prototype.toHHMMSS = function () {
					var sec_num = parseInt(this, 10);
					var hours   = Math.floor(sec_num / 3600000);
					var minutes = Math.floor((sec_num - (hours * 3600000)) / 60000);
					var seconds = (sec_num - (hours * 3600000) - (minutes * 60000))/1000;
					if (hours   < 10) {hours   = "0"+hours;}
					if (minutes < 10) {minutes = "0"+minutes;}
					if (seconds < 10) {seconds = "0"+seconds;}
					var time    = hours+':'+minutes+':'+seconds;
					return time;
				}
				
				function spinwheel() {
					if (spinning==false) {
						spinning = true;
						modalout();
						document.getElementById("spin").style.visibility = "hidden";
						document.getElementById("reset").style.visibility = "hidden";
						masterwheel.rotation.x = Math.random()*2*Math.PI;
						wordalign();
						spinvel = Math.random()*0.11+0.26
						microvel = Math.random()*0.000025+0.000075;
						microthr = Math.random()*0.01+0.015;
						micro = false;
						starttime = Date.now();
					}
				};
				
				function resetwheel(aminew=true,colorlist,mxrotation) {
					if (spinvel==0) {
						if (aminew==true || aminew.type=="click") {
							window.offset = Math.random(); 
							slcount = currlist.length;
						};
						if (typeof masterwheel != "undefined") {
							scene.remove(masterwheel);
						}
						sltheta = 2*Math.PI/slcount;
						masterwheel = new THREE.Group();
						for (i=0;i<slcount;i++) {
							slh = (window.offset+(0.618033988749895*i))%1;
							slicecolor = new THREE.Color
							if (aminew==false) {slicecolor = colorlist[i]}
							else {slicecolor.setHSL(slh,1,0.5)};
							slice = new THREE.Mesh(new THREE.CylinderGeometry(5,5,2,Math.max(Math.round(64/slcount),2),1,false,i*sltheta,sltheta), new THREE.MeshLambertMaterial({color:slicecolor}));
							slice.name = i.toString();
							slice.cc = slicecolor;
							masterwheel.add(slice);
						}
						masterwheel.rotation.z -= Math.PI/2;
						if (aminew==true || aminew.type=="click") {masterwheel.rotation.x += Math.random()*50-50/2}
						else {masterwheel.rotation.x = mxrotation};
						scene.add(masterwheel);
						lastseen = "0";
						pastseen = "0";
					}
				};
				
				function init() {
					scene = new THREE.Scene();
					camera = new THREE.PerspectiveCamera(40,1920/1080,1,100);
					renderer = new THREE.WebGLRenderer({antialias:true});
					renderer.setClearColor(0x000000, 1.0);
					renderer.setSize(window.innerWidth, window.innerHeight);
					scene.add(camera);
					camera.position.set(-25,4,10);
					light = new THREE.DirectionalLight(0xFFFFFF,1);
					light2 = new THREE.DirectionalLight(0xFFFFFF,0.5);
					light.position.set(-30,20,15);
					light2.position.set(-30,-10,15);
					light.lookAt({x:0,y:0,z:0});
					light2.lookAt({x:0,y:0,z:0});
					scene.add(light);
					scene.add(light2);
					camera.lookAt(5,-2,5);
					spinvel = 0;
					microvel = 0;
					microthr = 0;
					spinning=false;
					slcount = 0;
//					masterlist = [
//						"Ayy lmao",
//						"Reggie Fils",
//						"Curse of the Bard",
//						"Inn of the Giggling Donkey",
//						"Donkey Kong",
//						"Beavers 100% bothered",
//						"4th wall breaking: proof of concept",
//						"Pls donate - Jimmy Wales",
//						"More Cowbell",
//						"by Shel Silverstein",
//						"RIP sleep schedule",
//						"anime was a mistake",
//						"CASH ME OUSSIDE",
//						"mike pence is race bannon",
//						"here come dat boi",
//						"o shit waddup",
//						"bush did harambe",
//						"120 stars isn't worth it",
//						"jabroni",
//						"seinfeld is my favorite anime",
//						"how to disappoint your parents",
//						"pikachu is my favorite digimon",
//						"I am actually out of ideas.",
//					];
					masterlist = [];
					currlist = [];
					gamelist = [
							"Battleblock Theater",
							"Borderlands 2",
							"Castle Crashers",
							"Distance",
							"Grand Theft Auto V",
							"Monaco",
							"Portal 2",
							"Town of Salem",
							"Transformice",
							"Flash Games",
							"Rocket League",
							"Risk of Rain",
							"Cuphead",
							"Stick Fight: The Game",
							"Binding of Isaac: Rebirth",
							"Gang Beasts",
							"Hidden Folks",
							"Hotline Miami 1",
							"Hotline Miami 2",
							"Refunct",
							"Rogue Legacy",
							"Sonic Mania",
							"Spelunky",
							"Surgeon Simulator",
							"Windosill",
							"Hexcells infinite",
					]
					rifts = [
						"Madman's Rift",
						"Bard's Rift",
						"Playwright's Rift",
						"Jester's Rift",
						"Time Traveler's Rift",
						"Rift of the Giggling Donkey",
					]
					curses = [
						"Curse of the Sodden",
						"Curse of the Bard",
						"Curse of the Moon",
						"Curse of the Choosing Beggar",
						"Curse of the Twins",
						"Curse of the Warrior",
					]
					hexes = [
						"Hex of the Bulldog",
						"Hex of the White Cat",
						"Hex of the Rooster",
						"Hex of the Dodo",
						"Hex of the Mole",
						"Hex of the Honey Badger",
						"Hex of the Falcon",
						"Hex of the Goldfish",
					]
					blessings = [
						"Blessing of the Shaman",
						"Blessing of the Seraph",
						"Blessing of the Peasant",
						"Blessing of the Apothecary",
					]
					gambits = [
						"Gambit of the Wise",
						"Gambit of the Fool",
						"Gambit of the Deft",
					]
					descriptions = [
						["Madman's Rift","Finish your drink."],
						["Bard's Rift","Play one song. Cycle begins next spin."],
						["Playwright's Rift","Choose a TV show and agree upon 3 rules to drink. Select the episode randomly."],
						["Jester's Rift","Watch 10 minutes of the meme playlist. Starting point is random."],
						["Time Traveler's Rift","Reset the wheel and all hexes/curses/blessings. Heart containers persist."],
						["Rift of the Giggling Donkey","Watch a random videogamedunkey video."],
						["Curse of the Sodden","Current drink is now water. Double if on water round."],
						["Curse of the Bard","Play one song on an endless loop for the next cycle. You cannot mute it. Curse ends when drink ends."],
						["Curse of the Moon","Can't end on a winning streak, can't end on a loss."],
						["Curse of the Choosing Beggar","This is a wild card for curses."],
						["Curse of the Twins","Two drinks must be finished by the end of the cycle."],
						["Curse of the Warrior","Drink if any player dies or loses a round. Does not end when drink ends."],
						["Hex of the Bulldog","-1 heart container (to a minimum of 1)"],
						["Hex of the White Cat","Mute everything except discord."],
						["Hex of the Rooster","Satisfy 3 goals (or fewer if less than 3 heart containers). Each failure results in health loss."],
						["Hex of the Dodo","Purposely die 10 times or lose 3 rounds repeatedly. If you win or cannot complete this, a random curse is applied and this hex persists to the next cycle."],
						["Hex of the Mole","You cannot see one button, and cannot use it."],
						["Hex of the Honey Badger","You must play an arcade-style game for 10 minutes and reach some minimum score threshold. Failure results in a random curse."],
						["Hex of the Falcon","Cycle interval decreases by 10 minutes to a minimum of 30 minutes."],
						["Hex of the Goldfish","Spin a wheel containing only games. Play 1 round of each game for a total of 3 rounds."],
						["Blessing of the Shaman","+1 heart container, curses cured."],
						["Blessing of the Seraph","Immune from curses/hexes for 60 minutes.  Cannot be removed."],
						["Blessing of the Peasant","A wild card for use when bored. Does not extend the cycle."],
						["Blessing of the Apothecary","A potion that cures all curses now or can be saved to cure a curse later."],
						["Gambit of the Wise","Play a quiz from sporcle. 100% score prevents hexes and curses 1 time. >50th percentile, receive a blessing.  Otherwise sustain a curse."],
						["Gambit of the Fool","Play a 10 minute game for score, speed, or some other goal. Win for a blessing, lose for a curse."],
						["Gambit of the Deft","Finish a game or level in a certain amount of time for a Blessing of the Peasant.  You get one try."],
					]
					hardreset();
					health = 2;
					maxhealth = 2;
					adjhealth();
					arshape = new THREE.Shape();
					arshape.moveTo(0,0);
					arshape.lineTo(0.75,0.75);
					arshape.lineTo(0.75,0.25);
					arshape.lineTo(2,0.25);
					arshape.lineTo(2,-0.25);
					arshape.lineTo(0.75,-0.25);
					arshape.lineTo(0.75,-0.75);
					arshape.lineTo(0,0);
					var extset = {steps:1,amount:2,bevelEnabled:false};
					arrow = new THREE.Mesh(new THREE.ExtrudeGeometry(arshape,extset),new THREE.MeshLambertMaterial({color:0xFFFFFF}));
					arrow.rotation.y -= Math.PI/2;
					arrow.position.set(1,0,5);
					scene.add(arrow);
					vec = new THREE.Vector3(0,0,-1);
					sray = new THREE.Raycaster(arrow.position,vec,0,2);
					ctest = [];
					pastseen = "0";
					lastseen = "0";
					blackbox1 = new THREE.Mesh(new THREE.BoxGeometry(2,2,13),new THREE.MeshBasicMaterial({color:0x000000}));
					blackbox2 = new THREE.Mesh(new THREE.BoxGeometry(2,2,13),new THREE.MeshBasicMaterial({color:0x000000}));
					blackbox1.position.set(-1,6,13.5);
					blackbox2.position.set(-1,-6,13.5);
					scene.add(blackbox1,blackbox2);
					fps = new THREE.Clock();
					fps.start();
					imprefix = "url('https://raw.githubusercontent.com/Blunderbread/threejsmaze/master/maze/masterwheel/textures/"
					imsuffix = [["blur.jpg')",341],["caution.jpg')",44],["cross.jpg')",208],["dots.jpg')",43],["honeycomb.jpg')",35],["parallel.jpg')",194],["ribbons.jpg')",],["rug.jpg')",287],["geometric.jpg')",106],["space.jpg')",202],["drops.jpg')",84],["ribbons.jpg')",13],["speckled.jpg')",221],["tiles.jpg')",328],["waves.jpg')",219]];
				};
				
				function onWindowResize(){
					var width = window.innerWidth;
					var height = window.innerHeight;
					camera.updateProjectionMatrix();
					renderer.setSize(window.innerWidth,window.innerHeight);
				};
				
				function adjhealth(amount=0) {
					health -= amount;
					if (health>maxhealth) {health=maxhealth};
					if (health<0) {health=0};
					if (maxhealth<1) {maxhealth=1};
					for (i=(5-health);i>-1;i--) {
						document.getElementById("heart"+(5-i).toString()).innerHTML = "<img draggable='false' src='https://raw.githubusercontent.com/Blunderbread/threejsmaze/master/maze/masterwheel/empty2.png'></img>";
					}
					for (i=(5);i>(5-health);i--) {
						document.getElementById("heart"+(5-i).toString()).innerHTML = "<img draggable='false' src='https://raw.githubusercontent.com/Blunderbread/threejsmaze/master/maze/masterwheel/full2.png'></img>";
					}
					for (i=(5-maxhealth);i>-1;i--) {document.getElementById("heart"+(5-i).toString()).innerHTML = ""}
				};
				
				function wordsetup(aminew=true) {
					if (aminew==false || aminew.type=="click") {
						try {
							for (i=0;i<scrollist.length;i++) {
								scene.remove(scrollist[i])
							};
						}
						catch(e) {};
					};
					wma = [];
					scrollist = [];
					var loader = new THREE.FontLoader();
					loader.load( 'https://raw.githubusercontent.com/Blunderbread/threejsmaze/master/maze/masterwheel/helvetiker_regular.typeface.json', function (font) {
						for (i=0;i<currlist.length;i++) {
							var wordgeom = new THREE.TextGeometry(currlist[i], {
								font: font,
								size: 0.5,
								height: 0.5,
								curveSegments: 6
							} );
							wma.push(wordgeom);
						}
						rotsetup = masterwheel.rotation.x
						for (i=0;i<11;i++) {
							word = new THREE.Mesh(wma[i%wma.length],new THREE.MeshLambertMaterial({color:masterwheel.children[i%masterwheel.children.length].material.color}));
							word.rotation.y -= Math.PI/2;
							word.cc = masterwheel.children[i%masterwheel.children.length].cc;
							word.name = (i%masterwheel.children.length).toString()+"w";
							scrollist.push(word);
							word.position.set(-1,5-i,7.5);
							scene.add(word);
						};
						wordalign();
					});
				}
				
				function wordalign() {
					while ((masterwheel.rotation.x>(Math.PI*2)) || (masterwheel.rotation.x<0)) {
						if (masterwheel.rotation.x>(Math.PI*2)) {masterwheel.rotation.x-=(Math.PI*2)}
						else {masterwheel.rotation.x+=(Math.PI*2)};
					}
					csli = parseInt(scrollist[5].name.slice(0,scrollist[5].name.length-1))+scrollist[5].position.y+0.5;
					esli = -1*((masterwheel.rotation.x/(2*Math.PI)*masterwheel.children.length)-masterwheel.children.length);
					if (csli<esli) {csli+=masterwheel.children.length};
					slo = csli-esli;
					for (i=0;i<scrollist.length;i++) {
						scrollist[i].position.y -= slo;
					}
					wordswap();
				}
				
				function wordswap() {
					while (scrollist[scrollist.length-1].position.y<-5.5) {
						scene.remove(scrollist[scrollist.length-1]);
						scrollist.pop();
						a = parseInt(scrollist[0].name.slice(0,scrollist[0].name.length-1))-1;
						if (a<0) {a+=wma.length};
						word = new THREE.Mesh(wma[a],new THREE.MeshLambertMaterial({color:masterwheel.children[a].material.color}));
						word.rotation.y -= Math.PI/2;
						word.cc = masterwheel.children[a].cc;
						word.name = a.toString()+"w";
						word.position.set(-1,1+scrollist[0].position.y,7.5);
						scene.add(word);
						scrollist.unshift(word);
					};
				};

				function imgpicker() {
					imsel = imsuffix[Math.floor(Math.random()*imsuffix.length)];
					modal.style.backgroundImage = imprefix+imsel[0];
					csel = Math.round((selection.cc.getHSL().h*360)-imsel[1]);
					modal.style.filter = "hue-rotate("+csel+"deg)";
					modalin();
				}
				
				function sliceout(){
					document.getElementById("title").innerHTML = currlist[parseInt(lastseen)];
					for (i=0;i<descriptions.length;i++) {
						if (descriptions[i][0]==currlist[parseInt(lastseen)]) {document.getElementById("description").innerHTML = descriptions[i][1];}
					};
					selection = scene.getObjectByName(lastseen);
					imgpicker();
					setTimeout(subroutine, 2000);
					function subroutine() {
						document.getElementById("spin").style.visibility = "visible";
						document.getElementById("reset").style.visibility = "visible";
						masterwheel.remove(selection);
						slcount--;
						colorlist = [];
						for (i=0;i<masterwheel.children.length;i++) {
							colorlist.push(masterwheel.children[i].material.color);
						}
						currlist.splice(parseInt(lastseen),1);
						wordsetup(false);
						resetwheel(false,colorlist,masterwheel.rotation.x);
					}
				};
					
				function fisheryates(list) {
					var m = list.length, t, i;
					while (m) {
						i = Math.floor(Math.random() * m--);
						t = list[m];
						list[m] = list[i];
						list[i] = t;
					}
					return list;
				}
				
				function listmaker() {
					masterlist=[];
					currlist=[];
					for (i=0;i<3;i++) {
						masterlist = masterlist.concat(gamelist);
					}
					masterlist = fisheryates(masterlist)
					groupings = Math.floor(masterlist.length/5);
					for (j=0;j<groupings;j++) {
						currlist.push(masterlist[0+5*j]+" / "+masterlist[1+5*j]+" / "+masterlist[2+5*j]);
						currlist.push(masterlist[3+5*j]+" / "+masterlist[4+5*j]);
					}
					i=0;
					for (k=5*j;k<masterlist.length;k++) {
						currlist[1+(2*i)]+=" / "+masterlist[k];
						i++;
					}
					currlist = fisheryates(currlist);
				};
				
				function hardreset(aminewresetwheel=true,aminewresetwords=false) {
//					modalout();
					document.getElementById("spin").style.visibility = "visible";
					listmaker();
					resetwheel(aminewresetwheel);
					wordsetup(aminewresetwords);
				};
					
				function renderScene() {
					requestAnimationFrame(renderScene);
					renderer.render(scene,camera);
					deltfr = fps.getDelta();
					masterwheel.rotation.x += (spinvel*60*deltfr);
					for (i=0;i<scrollist.length;i++) {
						scrollist[i].position.y -= (masterwheel.children.length/(2*Math.PI))*spinvel*60*deltfr;
					}
					if (spinning==true) {
						if ((scrollist[scrollist.length-1].position.y<-5.5) || (scrollist[0].position.y>5.5)) {wordswap()};
					};
					scene.updateMatrixWorld();
					ctest = sray.intersectObject(masterwheel,true);
					if (spinning==true && ctest.length>0) {
						if (typeof ctest[0].object.name != "undefined") {lastseen = ctest[0].object.name};
						if (pastseen != lastseen) {
							a = scene.getObjectByName(pastseen);
							b = scene.getObjectByName(lastseen);
							a.material.color = a.cc;
							b.material.color = new THREE.Color(1,1,1);
							for (i=0;i<scrollist.length;i++) {
								if (scrollist[i].name==(pastseen+"w")) {scrollist[i].material.color=scrollist[i].cc};
								if (scrollist[i].name==(lastseen+"w")) {scrollist[i].material.color=new THREE.Color(1,1,1)};
							};
						};
						pastseen = lastseen;
					};
					if (spinvel>microthr) {spinvel -= 0.0015*60*deltfr}
					else if (spinvel>0) {
						spinvel -= microvel*60*deltfr}
					;
					if (spinvel<=0 && spinning==true) {
						spinning = false;
						spinvel = 0;
						if (currlist.length>2) {sliceout()}
						else {
							document.getElementById("title").innerHTML = currlist[parseInt(lastseen)];
							for (i=0;i<descriptions.length;i++) {
								if (descriptions[i][0]==currlist[parseInt(lastseen)]) {document.getElementById("description").innerHTML = descriptions[i][1];}
							};
							selection = scene.getObjectByName(lastseen);
							csel = (selection.cc.getHSL().h*360)-106;
							modal.style.filter = "hue-rotate("+csel+"deg)";
							modalin();
							hardreset();
						}
						spintime = (Date.now()-starttime).toString().toHHMMSS();
					};
				};
				
				init();
				$("#WebGL-output").append(renderer.domElement);
				renderScene();
			});
		</script>
	</body>
</html>
